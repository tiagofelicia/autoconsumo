=== Execu√ß√£o iniciada em 2025-10-06 08:57:26 ===

Attaching package: ‚Äòdplyr‚Äô

The following objects are masked from ‚Äòpackage:stats‚Äô:

    filter, lag

The following objects are masked from ‚Äòpackage:base‚Äô:

    intersect, setdiff, setequal, union


Attaching package: ‚Äòlubridate‚Äô

The following objects are masked from ‚Äòpackage:base‚Äô:

    date, intersect, setdiff, union


Attaching package: ‚Äòreadr‚Äô

The following object is masked from ‚Äòpackage:rvest‚Äô:

    guess_encoding

‚úÖ Bibliotecas carregadas
‚ÑπÔ∏è Data de in√≠cio da atualiza√ß√£o definida para: 2025-10-01
‚è≥ A extrair dados de futuros do ficheiro OMIPdaily.xlsx...
   - 1/4: A descarregar o ficheiro do URL...
   - 2/4: Ficheiro descarregado. A extrair a data do relat√≥rio...
New names:
‚Ä¢ `` -> `...1`
   - Data do relat√≥rio extra√≠da: 2025-10-03
   - 3/4: Ficheiro descarregado. A ler os dados...
New names:
‚Ä¢ `` -> `...1`
‚Ä¢ `` -> `...2`
‚Ä¢ `` -> `...3`
‚Ä¢ `` -> `...4`
‚Ä¢ `` -> `...5`
‚Ä¢ `` -> `...6`
‚Ä¢ `` -> `...7`
‚Ä¢ `` -> `...8`
‚Ä¢ `` -> `...9`
‚Ä¢ `` -> `...10`
‚Ä¢ `` -> `...11`
‚Ä¢ `` -> `...12`
‚Ä¢ `` -> `...13`
‚Ä¢ `` -> `...14`
‚Ä¢ `` -> `...15`
‚Ä¢ `` -> `...16`
‚Ä¢ `` -> `...17`
‚Ä¢ `` -> `...18`
‚Ä¢ `` -> `...19`
‚Ä¢ `` -> `...20`
‚Ä¢ `` -> `...21`
   - 4/4: A processar, limpar e desdobrar os dados dos futuros...
Warning message:
There was 1 warning in `mutate()`.
‚Ñπ In argument: `Data = case_when(...)`.
Caused by warning:
!  21 failed to parse. 
‚úÖ Dados de futuros extra√≠dos, processados e com prioriza√ß√£o di√°ria restaurada.
‚è≥ 2a: A ler o ficheiro hist√≥rico 'MIBEL.xlsx' (em hora de Espanha)...
‚è≥ 2b: A ler dados recentes do ano (INT_PBC_EV_H_ACUM.TXT)...
Warning message:
There were 3 warnings in `mutate()`.
The first warning was:
‚Ñπ In argument: `Data = dmy(DataStr)`.
Caused by warning:
!  1 failed to parse.
‚Ñπ Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings. 
‚è≥ 2c: A ler dados do dia seguinte (INDICADORES.DAT)...
‚è≥ 2d: A combinar fontes de dados com prote√ß√£o de hist√≥rico...
‚úÖ Todas as fontes de dados OMIE foram combinadas e processadas.
‚è≥ A combinar dados hist√≥ricos e futuros...
‚úÖ Pre√ßos di√°rios (reais e projetados) calculados.
‚è≥ Passo 4: Preparar estrutura completa de quartos-hor√°rios (ES)...
‚úÖ Estrutura ES criada com n√∫mero correto de quartos-hor√°rios e proje√ß√µes aplicadas apenas onde necess√°rio.
‚è≥ Passo 5: A converter dados finais para a hora de Portugal (respeitando DST e quartos-hor√°rios irregulares)...
‚úÖ 35036 registos finais preparados em hora de Portugal.
‚ö° Valida√ß√£o autom√°tica de quartos-hor√°rios:
# A tibble: 2 √ó 3
  Data           n tipo               
  <date>     <int> <chr>              
1 2025-03-30    96 Normal (96 quartos)
2 2025-10-26    96 Normal (96 quartos)
‚ö†Ô∏è Aviso: Dias com n√∫mero de quartos diferente do normal (96):
# A tibble: 1 √ó 3
  Data           n tipo                  
  <date>     <int> <chr>                 
1 2025-12-31    92 Primavera (92 quartos)
‚è≥ A atualizar o ficheiro 'Simulador_‚òÄÔ∏è_Autoconsumo_Tiago_Felicia.xlsx'...
‚úÖ O ficheiro Excel foi atualizado com sucesso!
   Data_Valores_OMIE = 2025-10-06
   Data_Valores_OMIP = 2025-10-03
=== Execu√ß√£o terminada em 2025-10-06 08:57:33 ===
Dura√ß√£o total: 7 segundos.

=== Execu√ß√£o iniciada em 2025-10-06 19:16:01 ===

Attaching package: ‚Äòdplyr‚Äô

The following objects are masked from ‚Äòpackage:stats‚Äô:

    filter, lag

The following objects are masked from ‚Äòpackage:base‚Äô:

    intersect, setdiff, setequal, union


Attaching package: ‚Äòlubridate‚Äô

The following objects are masked from ‚Äòpackage:base‚Äô:

    date, intersect, setdiff, union


Attaching package: ‚Äòreadr‚Äô

The following object is masked from ‚Äòpackage:rvest‚Äô:

    guess_encoding

‚úÖ Bibliotecas carregadas
‚ÑπÔ∏è Data de in√≠cio da atualiza√ß√£o definida para: 2025-10-01
‚è≥ A extrair dados de futuros do ficheiro OMIPdaily.xlsx...
   - 1/4: A descarregar o ficheiro do URL...
   - 2/4: Ficheiro descarregado. A extrair a data do relat√≥rio...
New names:
‚Ä¢ `` -> `...1`
   - Data do relat√≥rio extra√≠da: 2025-10-06
   - 3/4: Ficheiro descarregado. A ler os dados...
New names:
‚Ä¢ `` -> `...1`
‚Ä¢ `` -> `...2`
‚Ä¢ `` -> `...3`
‚Ä¢ `` -> `...4`
‚Ä¢ `` -> `...5`
‚Ä¢ `` -> `...6`
‚Ä¢ `` -> `...7`
‚Ä¢ `` -> `...8`
‚Ä¢ `` -> `...9`
‚Ä¢ `` -> `...10`
‚Ä¢ `` -> `...11`
‚Ä¢ `` -> `...12`
‚Ä¢ `` -> `...13`
‚Ä¢ `` -> `...14`
‚Ä¢ `` -> `...15`
‚Ä¢ `` -> `...16`
‚Ä¢ `` -> `...17`
‚Ä¢ `` -> `...18`
‚Ä¢ `` -> `...19`
‚Ä¢ `` -> `...20`
‚Ä¢ `` -> `...21`
   - 4/4: A processar, limpar e desdobrar os dados dos futuros...
Warning message:
There was 1 warning in `mutate()`.
‚Ñπ In argument: `Data = case_when(...)`.
Caused by warning:
!  21 failed to parse. 
‚úÖ Dados de futuros extra√≠dos, processados e com prioriza√ß√£o di√°ria restaurada.
‚è≥ 2a: A ler o ficheiro hist√≥rico 'MIBEL.xlsx' (em hora de Espanha)...
‚è≥ 2b: A ler dados recentes do ano (INT_PBC_EV_H_ACUM.TXT)...
Warning message:
There were 3 warnings in `mutate()`.
The first warning was:
‚Ñπ In argument: `Data = dmy(DataStr)`.
Caused by warning:
!  1 failed to parse.
‚Ñπ Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings. 
‚è≥ 2c: A ler dados do dia seguinte (INDICADORES.DAT)...
‚è≥ 2d: A combinar fontes de dados com prote√ß√£o de hist√≥rico...
‚úÖ Todas as fontes de dados OMIE foram combinadas e processadas.
‚è≥ A combinar dados hist√≥ricos e futuros...
‚úÖ Pre√ßos di√°rios (reais e projetados) calculados.
‚è≥ Passo 4: Preparar estrutura completa de quartos-hor√°rios (ES)...
‚úÖ Estrutura ES criada com n√∫mero correto de quartos-hor√°rios e proje√ß√µes aplicadas apenas onde necess√°rio.
‚è≥ Passo 5: A converter dados finais para a hora de Portugal (respeitando DST e quartos-hor√°rios irregulares)...
‚úÖ 35036 registos finais preparados em hora de Portugal.
‚ö° Valida√ß√£o autom√°tica de quartos-hor√°rios:
# A tibble: 2 √ó 3
  Data           n tipo               
  <date>     <int> <chr>              
1 2025-03-30    96 Normal (96 quartos)
2 2025-10-26    96 Normal (96 quartos)
‚ö†Ô∏è Aviso: Dias com n√∫mero de quartos diferente do normal (96):
# A tibble: 1 √ó 3
  Data           n tipo                  
  <date>     <int> <chr>                 
1 2025-12-31    92 Primavera (92 quartos)
‚è≥ A atualizar o ficheiro 'Simulador_‚òÄÔ∏è_Autoconsumo_Tiago_Felicia.xlsx'...
‚úÖ O ficheiro Excel foi atualizado com sucesso!
   Data_Valores_OMIE = 2025-10-07
   Data_Valores_OMIP = 2025-10-06
=== Execu√ß√£o terminada em 2025-10-06 19:16:08 ===
Dura√ß√£o total: 7 segundos.

=== Execu√ß√£o iniciada em 2025-10-07 17:43:28 ===

Attaching package: ‚Äòdplyr‚Äô

The following objects are masked from ‚Äòpackage:stats‚Äô:

    filter, lag

The following objects are masked from ‚Äòpackage:base‚Äô:

    intersect, setdiff, setequal, union


Attaching package: ‚Äòlubridate‚Äô

The following objects are masked from ‚Äòpackage:base‚Äô:

    date, intersect, setdiff, union


Attaching package: ‚Äòreadr‚Äô

The following object is masked from ‚Äòpackage:rvest‚Äô:

    guess_encoding

‚úÖ Bibliotecas carregadas
‚ÑπÔ∏è Data de in√≠cio da atualiza√ß√£o definida para: 2025-10-01
‚è≥ A extrair dados de futuros do ficheiro OMIPdaily.xlsx...
   - 1/4: A descarregar o ficheiro do URL...
   - 2/4: Ficheiro descarregado. A extrair a data do relat√≥rio...
New names:
‚Ä¢ `` -> `...1`
   - Data do relat√≥rio extra√≠da: 2025-10-07
   - 3/4: Ficheiro descarregado. A ler os dados...
New names:
‚Ä¢ `` -> `...1`
‚Ä¢ `` -> `...2`
‚Ä¢ `` -> `...3`
‚Ä¢ `` -> `...4`
‚Ä¢ `` -> `...5`
‚Ä¢ `` -> `...6`
‚Ä¢ `` -> `...7`
‚Ä¢ `` -> `...8`
‚Ä¢ `` -> `...9`
‚Ä¢ `` -> `...10`
‚Ä¢ `` -> `...11`
‚Ä¢ `` -> `...12`
‚Ä¢ `` -> `...13`
‚Ä¢ `` -> `...14`
‚Ä¢ `` -> `...15`
‚Ä¢ `` -> `...16`
‚Ä¢ `` -> `...17`
‚Ä¢ `` -> `...18`
‚Ä¢ `` -> `...19`
‚Ä¢ `` -> `...20`
‚Ä¢ `` -> `...21`
   - 4/4: A processar, limpar e desdobrar os dados dos futuros...
Warning message:
There was 1 warning in `mutate()`.
‚Ñπ In argument: `Data = case_when(...)`.
Caused by warning:
!  21 failed to parse. 
‚úÖ Dados de futuros extra√≠dos, processados e com prioriza√ß√£o di√°ria restaurada.
‚è≥ 2a: A ler o ficheiro hist√≥rico 'MIBEL.xlsx' (em hora de Espanha)...
‚è≥ 2b: A ler dados recentes do ano (INT_PBC_EV_H_ACUM.TXT)...
Warning message:
There were 3 warnings in `mutate()`.
The first warning was:
‚Ñπ In argument: `Data = dmy(DataStr)`.
Caused by warning:
!  1 failed to parse.
‚Ñπ Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings. 
‚è≥ 2c: A ler dados do dia seguinte (INDICADORES.DAT)...
‚è≥ 2d: A combinar fontes de dados com prote√ß√£o de hist√≥rico...
‚úÖ Todas as fontes de dados OMIE foram combinadas e processadas.
‚è≥ A combinar dados hist√≥ricos e futuros...
‚úÖ Pre√ßos di√°rios (reais e projetados) calculados.
‚è≥ Passo 4: Preparar estrutura completa de quartos-hor√°rios (ES)...
‚úÖ Estrutura ES criada com n√∫mero correto de quartos-hor√°rios e proje√ß√µes aplicadas apenas onde necess√°rio.
‚è≥ Passo 5: A converter dados finais para a hora de Portugal (respeitando DST e quartos-hor√°rios irregulares)...
‚úÖ 35036 registos finais preparados em hora de Portugal.
‚ö° Valida√ß√£o autom√°tica de quartos-hor√°rios:
# A tibble: 2 √ó 3
  Data           n tipo               
  <date>     <int> <chr>              
1 2025-03-30    96 Normal (96 quartos)
2 2025-10-26    96 Normal (96 quartos)
‚ö†Ô∏è Aviso: Dias com n√∫mero de quartos diferente do normal (96):
# A tibble: 1 √ó 3
  Data           n tipo                  
  <date>     <int> <chr>                 
1 2025-12-31    92 Primavera (92 quartos)
‚è≥ A atualizar o ficheiro 'Simulador_‚òÄÔ∏è_Autoconsumo_Tiago_Felicia.xlsx'...
‚úÖ O ficheiro Excel foi atualizado com sucesso!
   Data_Valores_OMIE = 2025-10-08
   Data_Valores_OMIP = 2025-10-07
=== Execu√ß√£o terminada em 2025-10-07 17:43:35 ===
Dura√ß√£o total: 7 segundos.

=== Execu√ß√£o Python iniciada em 2025-10-08 09:56:59 ===
Traceback (most recent call last):
  File "/home/runner/work/autoconsumo/autoconsumo/scripts/atualizacao_autoconsumo_MIBEL.py", line 164, in run_update_process
    wb = openpyxl.load_workbook(FICHEIRO_EXCEL)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/openpyxl/reader/excel.py", line 348, in load_workbook
    reader.read()
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/openpyxl/reader/excel.py", line 303, in read
    self.read_worksheets()
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/openpyxl/reader/excel.py", line 267, in read_worksheets
    charts, images = find_images(self.archive, rel.target)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/openpyxl/reader/drawings.py", line 28, in find_images
    src = archive.read(path)
          ^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/zipfile.py", line 1527, in read
    with self.open(name, "r", pwd) as fp:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/zipfile.py", line 1564, in open
    zinfo = self.getinfo(name)
            ^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/zipfile.py", line 1493, in getinfo
    raise KeyError(
KeyError: "There is no item named 'xl/drawings/drawing1.xml' in the archive"
‚úÖ Bibliotecas carregadas
‚ÑπÔ∏è Data de in√≠cio da atualiza√ß√£o definida para: 2025-10-01
‚ö†Ô∏è MODO: Apenas dados reais OMIE (sem futuros)

‚è≥ Passo 1: A ler e combinar dados OMIE (todos quarto-hor√°rios)...
   - 1a: A ler 'MIBEL.xlsx'...
   - 1b: A ler dados recentes (ACUM)...
   - 1c: A ler dados do dia seguinte (INDICADORES)...
   - 1d: A combinar fontes de dados...
‚úÖ Todas as fontes de dados OMIE foram combinadas.
   üìÖ √öltima data com dados: 2025-10-08

‚è≥ Passo 2: A criar estrutura completa at√© 2026...
   - Dados reais at√©: 2025-10-08
   - Estrutura criada at√©: 2026-12-31
   - Registos com dados reais: 35137
   - Registos vazios (futuros): 8068

‚è≥ Passo 3: A converter para hora de Portugal...
‚úÖ 35036 registos totais preparados em hora de Portugal.
   - Com dados reais: 26968
   - Vazios (NaN): 8068
‚úÖ Todos os dias t√™m n√∫mero de quartos esperado (92, 96 ou 100).

‚è≥ Passo 4: A atualizar o ficheiro 'Simulador_‚òÄÔ∏è_Autoconsumo_Tiago_Felicia.xlsx'...
‚ùå Ocorreu um erro inesperado: "There is no item named 'xl/drawings/drawing1.xml' in the archive"
=== Execu√ß√£o terminada em 2025-10-08 09:57:08 ===
Dura√ß√£o total: 9 segundos.
